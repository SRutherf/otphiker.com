<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="keywords" content="OTP, hiker, hiking">
    <meta name="description" content="OTP Hiker - CarPool">
    <title>OTP Hiker - West Valley Car Pool Schedule</title>
    <link href="css/css_style.css" rel="stylesheet" type="text/css">
    <!-- Phone -->
    <link href="css/phone.css" rel="stylesheet" type="text/css">

</head>

<body>
<div id="wrapper">

	<div id="header">OTP &amp; Others
		<br>
		<em>Hiking &amp; Debating Society</em> 
	</div>
		
	<div id="search">
		<form method=GET action=http://www.google.com/custom>
			<table bgcolor=#E89101 cellspacing=0 border=0>
				<tr valign=top>
					<td> <strong><A HREF=http://www.google.com/search> </A> </strong></td>
					<td> <strong>

					<input TYPE=text name=q size=31 maxlength=255 value="">
					<input type=submit name=sa VALUE="Google Search">
					<input type=hidden name=cof VALUE="AH:center;GL:0;S:http://www.philrutherford.com;AWFID:50053db864367844;">
					<font face=arial,sans-serif size=-1>
					<input type=hidden name=domains value="www.otphiker.com"><br>

					<input type=radio name=sitesearch value="" checked>
					</font></strong><font face=arial,sans-serif size=-1><font size="2" face="Verdana, Arial, Helvetica, sans-serif">www</font><strong>
					<input type=radio name=sitesearch value="www.otphiker.com">
					</strong><font size="2" face="Verdana, Arial, Helvetica, sans-serif">www.otphiker.com</font></font>
					</td>
				</tr>
			</table>
		</form>
	</div>
		
	<div id="navigation">
		&nbsp;&nbsp;&nbsp;
		<a href="index.html" title="Home">Home</a>&nbsp;&nbsp;&nbsp;
		<a href="about.html" title="About">About</a>&nbsp;&nbsp;&nbsp;
		<a href="site_map.html" title="Site-Map">Site-Map</a>&nbsp;&nbsp;&nbsp;
		<a href="schedule.html" title="Schedule">Schedule</a>&nbsp;&nbsp;&nbsp;
		<a href="attend.php" title="Attendance">Attendance</a>&nbsp;&nbsp;&nbsp;
		<a href="leader.html" title="Leader">Leader</a>&nbsp;&nbsp;&nbsp;
		<a href="description.html" title="Description">Description</a>&nbsp;&nbsp;&nbsp;
		<a href="history.html" title="History">History</a>&nbsp;&nbsp;&nbsp;
		<a href="database.html" title="Database">Database</a>&nbsp;&nbsp;&nbsp;
		<a href="safety.html" title="Safety">Safety</a>&nbsp;&nbsp;&nbsp;
		<a href="site_information.html" title="Site-Information">Site-Information</a>&nbsp;&nbsp;&nbsp;
		<a href="notices.html" title="News & Notices">News/Notices</a>&nbsp;&nbsp;&nbsp;
		<a href="trip_plan.html" title="Trip-Plan">Trip-Plan</a>&nbsp;&nbsp;&nbsp;
		<a href="links.html" title="External Links">Links</a>&nbsp;&nbsp;&nbsp;
		<a href="photos.html" title="Photos">Photos</a>&nbsp;&nbsp;&nbsp;
		<a href="photos.html" title="Videos">Videos</a>&nbsp;&nbsp;&nbsp;
		<a href="mikes_page.html" title="Mike's Page">Mike's Page</a>&nbsp;&nbsp;&nbsp;
		<a href="Memorial.html" title="Memorial">Memorial</a>&nbsp;&nbsp;&nbsp;
		<a href="contacts.html" title="Contacts">Contacts</a>
	</div>

	<div id="body_text">
	<div id="body_inner">

		<h1 style="margin-bottom: 0;">ATTENDANCE FOR THE NEXT HIKE</h1>
		<div align="center">
		<table width="600" border="0" cellspacing="1" cellpadding="5">
			<tr>
				<td>

					<p align="left">If you wish, you may let your fellow hikers know if you plan on attending next week's hike.</p>
					
					<table width="90%" bordercolor="#ababab" border="1" cellspacing="0" cellpadding="3">
						<tbody>
							<tr>
								<th height="49" colspan="9" scope="col">
									<p>
										<a href="hikes/1601.html">
										Hike 1601 Hollywood Sign from Brush Canyon</a>
										<br> Wednesday, January 8, 2025
										<br><br> Attendance Count: <span id="attendance-count">0</span>
									</p>
								</th>
							</tr>
							<tr>
								<th>Name</th>
								<th>Yes</th>
								<th>No</th>
								<th>Silent</th>
							</tr>
							<tbody id="attendance-table">
								<!-- Attendance rows populated dynamically -->
							</tbody>
							<tfoot>
								<tr>
									<td>Totals</td>
									<td id="attendance-yes-total" align="center">0</td>
									<td id="attendance-no-total" align="center">0</td>
									<td id="attendance-silent-total" align="center">0</td>
								</tr>
							</tfoot>
						</tbody>
					</table>
				</td>
			</tr>
		</table>
		<br>
		<h1 style="margin-bottom: 0;">WEST VALLEY CAR POOL SCHEDULE</h1>
		<table width="600" border="0" cellspacing="1" cellpadding="5">
			<tr>
				<td>
					<!-- <p align="left">The next designated driver(s) are determined by the lowest cumulative passenger-miles accumulated, identified in green.  See <a href="carpool/Driver_Selection.pdf">Driver Selection</a>.</p>
					<p align="left">If the number of hikers exceeds the seating capacity of the primary driver (Drive 1), then the secondary driver (Drive 2) will be assigned based on next lowest cumulative passenger-miles. If designated driver(s) are not hiking this week, then the next available driver(s) will be chosen based on the next driver priority on the <a href="carpool/Driver_Selection.pdf">Driver Selection</a> spreadsheet. It is the responsibility of the absent designated driver(s) to reselect the next designated driver(s).</p>
					<p align="left">In general, meeting location will be the home of the primary designated driver.</p>
					<p align="left">For more detailed explanation and instructions on the use of this process, go to <a href="carpool_instructions.html">instructions</a>.</p> -->   
					
					<table width="90%" bordercolor="#ababab" border="1" cellspacing="0" cellpadding="3">
						<tbody>
							<tr>
								<th height="49" colspan="9" scope="col">
									<p>
										<a href="hikes/1601.html">
										Hike 1601 Hollywood Sign from Brush Canyon</a>
										<br> Wednesday, January 8, 2025
										<br><br> Departure Time: 8:00 am
									</p>
								</th>
							</tr>
							<tr>
								<th>Name</th>
								<th>Seats</th>
								<th>Yes</th>
								<th>No</th>
								<th>Silent</th>
								<th>Drive 1</th>
								<th>Drive 2</th>
								<th>Meet</th>
							</tr>
						</thead>
						<tbody id="carpool-table">
							<!-- Carpool rows populated dynamically -->
						</tbody>
						<tfoot>
							<tr id="no-selection-row">
								<td>No Selection</td>
								<td align="center">-</td>
								<td align="center">-</td>
								<td align="center">-</td>
								<td align="center">-</td>
								<td align="center"><input type="radio" name="drive1" value="none" data-id="noselect" data-column="drive1"></td>
								<td align="center"><input type="radio" name="drive2" value="none" data-id="noselect" data-column="drive2"></td>
								<td align="center"><input type="radio" name="meet" value="none" data-id="noselect" data-column="meet"></td>
							</tr>
							<tr>
								<td>Totals</td>
								<td align="center">-</td>
								<td id="carpool-yes-total"  align="center">0</td>
								<td id="carpool-no-total" align="center">0</td>
								<td id="carpool-silent-total" align="center">0</td>
								<td id="carpool-drive1-total" align="center">-</td>
								<td id="carpool-drive2-total" align="center">-</td>
								<td id="carpool-meet-total" align="center">-</td>
							</tr>
						</tfoot>
						</tbody>
					</table>
				</td>
			</tr>
		</table>
		</div>
	</div>
	</div>

	<div id="navigation">
		&nbsp;&nbsp;&nbsp;
		<a href="index.html" title="Home">Home</a>&nbsp;&nbsp;&nbsp;
		<a href="about.html" title="About">About</a>&nbsp;&nbsp;&nbsp;
		<a href="site_map.html" title="Site-Map">Site-Map</a>&nbsp;&nbsp;&nbsp;
		<a href="schedule.html" title="Schedule">Schedule</a>&nbsp;&nbsp;&nbsp;
		<a href="attend.php" title="Attendance">Attendance</a>&nbsp;&nbsp;&nbsp;
		<a href="leader.html" title="Leader">Leader</a>&nbsp;&nbsp;&nbsp;
		<a href="description.html" title="Description">Description</a>&nbsp;&nbsp;&nbsp;
		<a href="history.html" title="History">History</a>&nbsp;&nbsp;&nbsp;
		<a href="database.html" title="Database">Database</a>&nbsp;&nbsp;&nbsp;
		<a href="safety.html" title="Safety">Safety</a>&nbsp;&nbsp;&nbsp;
		<a href="site_information.html" title="Site-Information">Site-Information</a>&nbsp;&nbsp;&nbsp;
		<a href="notices.html" title="News & Notices">News/Notices</a>&nbsp;&nbsp;&nbsp;
		<a href="trip_plan.html" title="Trip-Plan">Trip-Plan</a>&nbsp;&nbsp;&nbsp;
		<a href="links.html" title="External Links">Links</a>&nbsp;&nbsp;&nbsp;
		<a href="photos.html" title="Photos">Photos</a>&nbsp;&nbsp;&nbsp;
		<a href="photos.html" title="Videos">Videos</a>&nbsp;&nbsp;&nbsp;

		<a href="mikes_page.html" title="Mike's Page">Mike's Page</a>&nbsp;&nbsp;&nbsp;

		<a href="Memorial.html" title="Memorial">Memorial</a>&nbsp;&nbsp;&nbsp;
		<a href="contacts.html" title="Contacts">Contacts
	</a>
	</div>

	<div id="footer">
		<div id="footer_left">
			Copyright &copy; 1983-2022 OTP Hiker
			<br> 
			Last updated at 5:10 pm PST on 01/02/2025
			<br>
		</div>
	</div>

	<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
	</script>
	<script src="js/jquery-1.11.3.min.js" type="text/javascript"></script>
	<script src="new/js/bootstrap.js" type="text/javascript"></script>
	<script type="text/javascript">
		_uacct = "UA-2679891-3";
		urchinTracker();
	</script>

	<script>
		jQuery(document.links)   .filter(function() {     return this.hostname != window.location.hostname;   })     .attr('target', '_blank');
	</script>
	
</div>
	<script>
		document.addEventListener('DOMContentLoaded', function () {
			let lastUpdate = 0;
			const pollInterval = 2;
            let timer = pollInterval;

			function populateTables() {
                fetch('get.php')
                    .then(response => response.json())
                    .then(data => {
                        if (data.lastUpdate > lastUpdate) { // Only update if there's newer data
                            lastUpdate = data.lastUpdate;
                            populateAttendanceTable(data.attendance);
                            populateCarpoolTable(data.carpool);
                        }
                    })
                    .catch(error => console.error('Error fetching data:', error))
                    .finally(() => {
                        timer = pollInterval; // Reset the timer after update
                    });
            }

			function updateDatabase(id, column, value, table) {
				fetch('update.php', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({ id, column, value, table }),
				})
					.then(response => response.json())
					.then(data => {
						if (data.success) {
							console.log('Database updated successfully.');
						} else {
							console.error('Database update failed:', data.error);
						}
					})
					.catch(error => console.error('Error updating database:', error));
			}

			function attachEventListeners() {
				document.addEventListener('change', function (event) {
					if (event.target.matches('input[type="radio"][data-id]')) {
						const id = event.target.getAttribute('data-id');
						const column = event.target.getAttribute('data-column');
						const value = column === 'status' ? event.target.value : (event.target.checked ? 1 : 0);
						const table = event.target.getAttribute('name').includes('attendance') ? 'attendance': 'carpool';

						// Update the table immediately
						if (column !== 'status') {
							document.querySelectorAll(`input[name="${column}"]`).forEach(input => {
								input.checked = false;
							});
							event.target.checked = true;
						}

						updateDatabase(id, column, value, table);
					}
				});
			}
			
			function updateAttendanceCount() {
				const attendanceYes = parseInt(document.getElementById('attendance-yes-total').textContent) || 0;
				const carpoolYes = parseInt(document.getElementById('carpool-yes-total').textContent) || 0;
				const total = attendanceYes + carpoolYes;
				document.getElementById('attendance-count').textContent = total;
			}

			function startPolling() {
                setInterval(() => {
                    populateTables();
                }, pollInterval * 1000); // Poll every 5 seconds
            }

            function startTimer() {
                const timerElement = document.getElementById('timer');
                setInterval(() => {
                    if (timer > 0) {
                        timer--;
                        timerElement.textContent = timer;
                    }
                }, 1000); // Update the timer every second
            }

			function populateAttendanceTable(attendanceData) {
				const tbody = document.getElementById('attendance-table');
				let yesCount = 0, noCount = 0, silentCount = 0;

				tbody.innerHTML = '';

				attendanceData.forEach(row => {
					const tr = document.createElement('tr');
					const nameTd = document.createElement('td');
					nameTd.textContent = row.name;
					tr.appendChild(nameTd);

					['yes', 'no', 'silent'].forEach(status => {
						const td = document.createElement('td');
						td.style.textAlign = 'center';
						td.innerHTML = `<input type="radio" name="attendance_${row.id}" value="${status}" 
										${row.status === status ? 'checked' : ''} data-id="${row.id}" data-column="status">`;
						if (row.status === status) status === 'yes' ? yesCount++ : status === 'no' ? noCount++ : silentCount++;
						tr.appendChild(td);
					});

					tbody.appendChild(tr);
				});

				document.getElementById('attendance-yes-total').textContent = yesCount;
				document.getElementById('attendance-no-total').textContent = noCount;
				document.getElementById('attendance-silent-total').textContent = silentCount;
				updateAttendanceCount();
			}

			function populateCarpoolTable(carpoolData) {
				const tbody = document.getElementById('carpool-table');
				let yesCount = 0, noCount = 0, silentCount = 0;
				let drive1Selected = false,
					drive2Selected = false,
					meetSelected = false;

				tbody.innerHTML = '';

				carpoolData.forEach((row, index) => {
					const tr = document.createElement('tr');
					const nameTd = document.createElement('td');
					nameTd.textContent = row.name;
					tr.appendChild(nameTd);

					const seatsTd = document.createElement('td');
					seatsTd.style.textAlign = 'center';
					seatsTd.textContent = row.seats;
					tr.appendChild(seatsTd);

					['yes', 'no', 'silent'].forEach((status) => {
						const td = document.createElement('td');
						td.style.textAlign = 'center';
						td.innerHTML = `<input type="radio" name="carpool_${row.id}" value="${status}" 
										${row.status === status ? 'checked' : ''} data-id="${row.id}" data-column="status">`;
						if (row.status === status) {
							if (status === 'yes') yesCount++;
							if (status === 'no') noCount++;
							if (status === 'silent') silentCount++;
						}
						tr.appendChild(td);
					});

					['drive1', 'drive2', 'meet'].forEach((column) => {
						const td = document.createElement('td');
						td.style.textAlign = 'center';
						const isSelected = parseInt(row[column]) === 1;
						td.innerHTML = `<input type="radio" name="${column}" value="${index}" 
										${isSelected ? 'checked' : ''} data-id="${row.id}" data-column="${column}">`;
						if (isSelected) {
							if (column === 'drive1') drive1Selected = true;
							if (column === 'drive2') drive2Selected = true;
							if (column === 'meet') meetSelected = true;
						}
						tr.appendChild(td);
					});

					tbody.appendChild(tr);
				});

				if (!drive1Selected) document.querySelector('input[name="drive1"][value="none"]').checked = true;
				if (!drive2Selected) document.querySelector('input[name="drive2"][value="none"]').checked = true;
				if (!meetSelected) document.querySelector('input[name="meet"][value="none"]').checked = true;
				
				document.getElementById('carpool-yes-total').textContent = yesCount;
				document.getElementById('carpool-no-total').textContent = noCount;
				document.getElementById('carpool-silent-total').textContent = silentCount;
				updateAttendanceCount();
			}

			populateTables();
			attachEventListeners();
			startPolling();
            startTimer();
		});
	</script>
</body>
</html>